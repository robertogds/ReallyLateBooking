// Generated by CoffeeScript 1.3.3
(function() {

  root.xhrFetchUser = Titanium.Network.createHTTPClient({
    timeout: 9000
  });

  root.xhrFetchUser.onload = function(e) {
    var response;
    root.hideLoading(root.newAccountWindow);
    Ti.API.info('USER: ' + this.responseText);
    response = JSON.parse(this.responseText);
    if (response.status === 200) {
      Ti.API.info('*********** ENTRA EN FETCH USER CON REFERERID = ' + response.refererId);
      root.user = response.content;
      return Titanium.App.Properties.setString("user", JSON.stringify(root.user));
    }
  };

  root.xhrFetchUser.onerror = function(e) {
    Ti.API.info('Entra en error fetchUser');
    return Ti.API.error(e);
  };

  root.fetchServerUser = function() {
    var proto, signature, url;
    url = root.urlSignature("/user/" + root.user.id);
    signature = root.doSignature(url);
    url = root.surl + url + '/' + signature;
    proto = 'GET';
    root.xhrFetchUser.open(proto, url);
    root.xhrFetchUser.setRequestHeader("Content-Type", "application/json; charset=utf-8");
    root.xhrFetchUser.setRequestHeader("Accept-Language", Titanium.Locale.currentLanguage);
    root.xhrFetchUser.send();
    return Ti.API.info('LLeta hasta el final');
  };

}).call(this);
