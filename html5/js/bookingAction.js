(function(){root.xhrBooking=Titanium.Network.createHTTPClient();root.xhrBooking.onload=function(){var a;Ti.API.info(this.responseText);Ti.API.info("_____________________ ENTRA EN COMPRA CON EXITO ********************");root.hideLoading(root.confirmBookingWindow);try{a=JSON.parse(this.responseText)}catch(b){Ti.UI.createAlertDialog({title:"ReallyLateBooking",message:L("errorBooking")}).show()}Ti.API.info(a);if(201===a.status)return root.showOneBookingView(a.content);Ti.API.error("error de compra");
return Ti.UI.createAlertDialog({title:"ReallyLateBooking",message:"Error: "+a.detail}).show()};root.xhrBooking.onerror=function(a){root.hideLoading(root.confirmBookingWindow);root.showError();return Ti.API.error(a)};root.doBooking=function(){var a,b;Ti.API.info("_____________________ ENTRA EN COMPRAR ********************");root.showLoading(root.confirmBookingWindow);root.xhrBooking.setTimeout(15E3);b=root.urlSignature("/booking");a=root.doSignature(b);root.xhrBooking.open("POST",root.surl+(b+"/"+
a));root.xhrBooking.setRequestHeader("Content-Type","application/json; charset=utf-8");root.xhrBooking.setRequestHeader("Accept-Language",Titanium.Locale.currentLanguage);a=JSON.stringify({userId:root.user.id,dealId:root.deal.id,nights:root.bookingNights,creditCardType:root.cardType,creditCard:root.cardNumberText.value,creditCardName:root.cardNameText.value,creditCardExpiry:root.expireMonthText.value+"/"+root.expireYearText.value,creditCardCVC:root.cvcCodeText.value,bookingForEmail:root.bookingForEmail,
bookingForFirstName:root.bookingForFirstName,bookingForLastName:root.bookingForLastName});Ti.API.info(a);Ti.API.info("Paso pre-compra");root.xhrBooking.send(a);return Ti.API.info("Paso post-compra")};root.returnCardType=function(a){return/^4[0-9]{12}(?:[0-9]{3})?$/.test(a)?"Visa":/^5[1-5][0-9]{14}$/.test(a)?"Mastercard":/^5[1-5][0-9]{14}$/.test(a)?"American Express":"WRONG"};root.validateBookingData=function(){return!(0<root.user.id)?Ti.Locale.getString("errorUser"):!(0<root.deal.id)?Ti.Locale.getString("errorNoDeal"):
!0}}).call(this);