(function(){root.xhrLoadCredits=Titanium.Network.createHTTPClient({timeout:15E3});root.xhrLoadCredits.onload=function(){var a,b,d,c;Ti.API.info("Entra en load credits OK");root.creditsLastUpdate=new Date;Ti.API.info(this.responseText);root.credits=JSON.parse(this.responseText);root.totalCredit=0;c=root.credits;for(b=0,d=c.length;b<d;b++)a=c[b],root.totalCredit+=a.credits;root.balanceLabel.text=root.totalCredit+"\u20ac";root.creditsTab.badge=0===root.totalCredit?void 0:root.totalCredit;"deals"===root.tabGroup.activeTab.id&&
root.showConfirmBooking();root.hideLoading(root.creditsWindow);return root.hideLoading(root.oneDealWindow)};root.xhrLoadCredits.onerror=function(){Ti.API.info("Entra en load Credits ERROR");Ti.UI.createAlertDialog({title:"ReallyLateBooking",message:L("errorHappened")}).show();root.hideLoading(root.creditsWindow);return root.hideLoading(root.oneDealWindow)};root.fetchCreditsConnect=function(){var a,b;Ti.API.info("Es necesario actualizar");b=root.urlSignature("/user/"+root.user.id+"/coupons");a=root.doSignature(b);
root.xhrLoadCredits.open("GET",root.url+(b+"/"+a));root.xhrLoadCredits.setRequestHeader("Accept-Language",Titanium.Locale.currentLanguage);return root.xhrLoadCredits.send()};root.fetchCredits=function(){var a;Ti.API.info("Entra en fetchCredits");a=new Date;void 0===root.creditsLastUpdate&&(root.creditsLastUpdate=new Date);a=a.getTime()-root.creditsLastUpdate.getTime();Ti.API.info("FetchCredits -- La diferencia es "+a);if(void 0===root.credits||6E4<a)return root.fetchCreditsConnect();Ti.API.info("ListCredits: No es necesario actualizar");
"deals"===root.tabGroup.activeTab.id&&root.showConfirmBooking();root.hideLoading(root.creditsWindow);return root.hideLoading(root.oneDealWindow)}}).call(this);