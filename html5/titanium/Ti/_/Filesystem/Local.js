define("Ti/_,Ti/_/declare,Ti/_/encoding,Ti/_/lang,Ti/API,Ti/Blob".split(","),function(x,y,F,G,z,A){function o(a,c){return e.getItem("ti:fs:"+(c?"meta:":"blob:")+a)}function p(a,c,b){e.setItem("ti:fs:"+(b?"meta:":"blob:")+a,c);return c.length}function B(a){var c=[],b;h||(h={"/":"tD\nr1"},require("./titanium/filesystem.registry").split(/\n|\|/).forEach(function(a,b){var f=0,a=a.split("\t"),e=a.length,q;if(0===b&&"ts"===a[0])k=a[1],h[g]+="\nc"+k;else{for(;f<e&&!a[f];f++);c=c.slice(0,f).concat(q=a[f]);
h[g+c.join(g)]="n"+q+"\nt"+(f+1==e?"D":"F\ns"+a[f+1])}}));return(b=h[a])&&b+"\nr1\ne1\nc"+k+"\nm"+k}function r(a,c,b,d){var b=b||1,e=a+c.slice(0,b).join(g);if(d&&d.readonly)return z.error('Unable to create "'+e+'" because parent is readonly'),!1;d=new l({nativePath:e,type:"D"});d.createDirectory();return++b>c.length?!0:r(a,c,b,d)}function s(a){if(a){var a=a.match(m),c=(a[1]?a[1]:a[2]+a[3])||g;return(a=a[1]?a[2]:a[4])?r(c,a.split(g)):!0}return!1}function t(a,c){var b=a.nativePath,b=RegExp("^(ti:fs:meta|ti:fs:blob):"+
b+(/\/$/.test(b)?"":g)+"(.*)"),d,i,f=0,j=e.length,c=(n||(n=require("Ti/Filesystem"))).getFile(c.nativePath,a.name);if(s(c.nativePath)){for(;f<j;)i=e.key(f++),(d=i.match(b))&&e.setItem(d[1]+":"+c.nativePath+g+d[2],e.getItem(i)||"");return!0}return!1}function u(){for(var a=/^ti:fs:tmp:\/\//,c=0,b=e.length,d;c<b;)d=e.key(c++),a.test(d)&&e.removeItem(d)}var h,k=(new Date).getTime(),l,n,v=require.is,e=localStorage,g="/",C={n:"sname",c:"i_created",m:"i_modified",t:"s_type",y:"s_mimeType",e:"b_remote",x:"bexecutable",
r:"breadonly",s:"isize",l:"bsymbolicLink",h:"bhidden"},D={i:function(a){return a-0},s:function(a){return""+a},b:function(a){return!!(a|0)}},m=/(\/)?([^\:]*)(\:\/\/)?(.*)/,w="application/octet-stream,text/plain,text/html,text/css,text/xml,text/mathml,image/gif,image/jpeg,image/png,image/x-icon,image/svg+xml,application/x-javascript,application/json,application/pdf,application/x-opentype,audio/mpeg,video/mpeg,video/quicktime,video/x-flv,video/x-ms-wmv,video/x-msvideo,video/ogg,video/mp4,video/webm,text/csv".split(","),
E={txt:1,html:2,htm:2,css:3,xml:4,mml:5,gif:6,jpeg:7,jpg:7,png:8,ico:9,svg:10,js:11,json:12,pdf:13,otf:14,mp3:15,mpeg:16,mpg:16,mov:17,flv:18,wmv:19,avi:20,ogg:21,ogv:21,mp4:22,m4v:22,webm:23,csv:24};u();require.on(window,"beforeunload",u);(function(a,c){for(var b in a)o(b,1)||p(b,"c"+c+"\nm"+c+"\ntD\ne0\nx0\nl0\nh0\nr"+a[b],1)})({"appdata://":0,"/":1,"tmp://":0},(new Date).getTime());return l=y("Ti._.Filesystem.Local",null,{constructor:function(a){if(v(a,"String")){var c=a.match(m),b=!c[1]&&c[3];
if(/^\.\./.test(a=b?c[4]:c[2]))throw Error('Irrational path "'+a+'"');this.constants.__values__.nativePath=(b?c[2]+"://":g)+a}this._type=!a||"D"===a._type?"D":"F"},postscript:function(){var a=this.constants,c=this.nativePath,b=c&&o(c,1)||B(c),d=c.match(m),e=(d[1]?d[1]:d[2]+d[3])||g;b&&(this._exists=1)&&b.split("\n").forEach(function(b){var c=C[b.charAt(0)],d=c.substring(1),b=D[c.charAt(0)](b.substring(1));(a.hasOwnProperty(d)?a.__values__:this)[d]=b},this);c=d[1]?d[2]:d[4];b=c.split(g);a.name=b.pop();
b=b.join(g);(c=a.parent=c?new l(e+b):null)&&c.readonly||d&&d[1]&&(a.readonly=!0)},constants:{name:"",executable:!1,readonly:!1,size:0,symbolicLink:!1,nativePath:"",parent:null,writable:{get:function(){return!this.readonly},set:function(a){return this.constants.__value__.readonly=!a},value:!0}},properties:{hidden:!1},append:function(a){if(this.isFile()){switch(a&&a.declaredClass){case "Ti.Filesystem.File":a=a.read();case "Ti.Blob":this._mimeType=a.mimeType,a=a.text}var c=this.read();c.append(a);return this.write(c)}return!1},
copy:function(a){if(this.exists&&a){var c=n||(n=require("Ti/Filesystem")),a="Ti.Filesystem.File"===a.declaredClass?a:c.getFile.apply(null,arguments),b=a.parent,d=this.isFile();if(a.exists()){if(a.readonly)return!1;return a.isFile()?!d?(Ti.API.error("Destination is not a directory"),!1):a.write(this.read()):d?c.getFile(a.nativePath,this.name).write(this.read()):t(this,a)}return b&&(b.createDirectory(),!b.exists()||b.readonly||!d&&!a.createDirectory())?!1:d?a.write(this.read()):t(this,a)}return!1},
createDirectory:function(){return this._create("D")},createFile:function(){return this._create("F")},createTimestamp:function(){return this._created||null},deleteDirectory:function(a){if(this.isDirectory()&&!this.readonly){for(var c=this.nativePath,b=RegExp("^ti:fs:(meta|blob):"+c+(/\/$/.test(c)?"":g)+".*"),d=0,i=e.length;d<i;)if(b.test(key=e.key(d++))){if(!a)return Ti.API.error('Directory "'+c+'" not empty'),!1;e.removeItem(key)}this._exists=0;e.removeItem("ti:fs:meta:"+c);e.removeItem("ti:fs:blob:"+
c);return!0}return!1},deleteFile:function(){if(this.exists()&&this.isFile()&&!this.readonly){var a=this.nativePath;this._exists=0;e.removeItem("ti:fs:meta:"+a);e.removeItem("ti:fs:blob:"+a);return!0}return!1},exists:function(){return!!this._exists},extension:function(){var a=this.name.match(/\.(.+)$/);return a?a[1]:""},getDirectoryListing:function(){var a=[];if(this.isDirectory()){for(var c=this.nativePath+(/\/$/.test(this.nativePath)?"":g),b=RegExp("^ti:fs:meta:"+c+"(.*)"),c=RegExp("^"+c+"(.*)"),
d=0,i=e.length,f=function(b,c){var d,e=b.match(c);e&&e[1]&&0>a.indexOf(d=e[1].split(g)[0])&&a.push(d)};d<i;)f(e.key(d++),b);for(d in h)f(d,c)}return a.sort()},isDirectory:function(){return"D"===this._type},isFile:function(){return"F"===this._type},modificationTimestamp:function(){return this._modified||null},move:function(){return this.copy.apply(this,arguments)&&this[this.isFile()?"deleteFile":"deleteDirectory"](1)},open:function(a){var c=require("Ti/Filesystem/FileStream");return this.exists()&&
this.isFile()?new c({mode:a,data:this.read().text}):null},read:function(){if(this.exists()&&this.isFile()){var a=this.nativePath,c,b;this._remote?(b=new XMLHttpRequest,b.overrideMimeType("text/plain; charset=x-user-defined"),b.open("GET","."+a,!1),b.send(null),b=(c=200===b.status?{data:b.responseText,mimeType:b.getResponseHeader("Content-Type")}:null).data):b=o(a)||"";var d=w[E[this.extension()]||0];c=c&&c.mimeType||this._mimeType||d;var e=0,f=b.length,g="",a={file:this,data:b,length:f,mimeType:c=
"application/octet-stream"===c&&c!==d?d:c,nativePath:a};if(this._remote&&x.isBinaryMimeType(c)){for(;e<f;)g+=String.fromCharCode(b.charCodeAt(e++)&255);a.data=btoa(g)}return new A(a)}return null},rename:function(a){if(this.exists&&!this.readonly){var c=this.nativePath,b=c,d=e.getItem("ti:fs:blob:"+b),i=RegExp("^ti:fs:(meta|blob):"+b+(/\/$/.test(b)?"":g)+"(.*)"),f=b.match(m),j=(f[1]?f[1]:f[2]+f[3])||g,h=0,k=e.length,b=f[1]?f[2]:f[4];if(!b)return Ti.API.error("Can't rename root \""+j+'"'),!1;b=b.split(g);
b.pop();b.push(a);f=new l(b=j+b.join(g));if(f.exists()||f.parent.readonly)return!1;if("D"===this._type)for(;h<k;)if(j=e.key(h++),f=j.match(i))e.setItem("ti:fs:"+f[1]+":"+b+g+f[2],e.getItem(j)),e.removeItem(j);this._save(b,a);d&&e.setItem("ti:fs:blob:"+b,d);e.removeItem("ti:fs:meta:"+c);e.removeItem("ti:fs:blob:"+c);return!0}return!1},resolve:function(){return this.nativePath},spaceAvailable:function(){return"remainingSpace"in e?e.remainingSpace:null},write:function(a,c){var b=this.nativePath;if(b&&
this.isFile()&&!this.readonly&&this.parent&&!this.parent.readonly){a&&v(a,"String")&&(this._mimeType=w[1]);switch(a&&a.declaredClass){case "Ti.Filesystem.File":a=a.read();case "Ti.Blob":this._mimeType=a.mimeType,a=a._data||""}this._exists=1;this._modified=(new Date).getTime();this._created||(this._created=this._modified);this.constants.__values__.size=p(b,c?this.read()+a:a);return this._save()}return!1},_create:function(a){return!this.exists()&&this.parent&&!this.parent.readonly&&s(this.parent.nativePath)?
(this._created=this._modified=(new Date).getTime(),this._exists=1,this._type=a,this._save()):!1},_save:function(a,c){var a=a||this.nativePath,b;return a?(b=["n",c||this.name,"\nc",this._created,"\nm",this._modified,"\nt",this._type,"\ne0\nx0\nr",this.readonly|0,"\nl",this.symbolicLink|0,"\nh",this.hidden|0],"F"===this._type&&b.push("\ns"+this.size),this._mimeType&&b.push("\ny"+this._mimeType),p(a,b.join(""),1),!0):!1}})});