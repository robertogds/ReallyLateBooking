// Generated by CoffeeScript 1.3.3
(function() {

  root.xhrLoadCredits = Titanium.Network.createHTTPClient({
    timeout: 15000
  });

  root.xhrLoadCredits.onload = function() {
    var credit, creditRow, credits, data, _i, _len;
    Ti.API.info('Entra en load credits OK');
    root.listCreditsWindow.remove(root.errorView);
    Ti.API.info(this.responseText);
    credits = JSON.parse(this.responseText);
    data = [];
    for (_i = 0, _len = credits.length; _i < _len; _i++) {
      credit = credits[_i];
      creditRow = new root.CreditsRow(credit);
      data.push(creditRow.row);
    }
    if (data.length === 0) {
      root.noCreditsView.show();
    } else {
      root.creditsTable.setData(data);
    }
    root.creditsTable.footerView = root.footerView;
    return root.hideLoading(root.listCreditsWindow);
  };

  root.xhrLoadCredits.onerror = function() {
    Ti.UI.createAlertDialog({
      title: 'ReallyLateBooking',
      message: L('errorHappened')
    }).show();
    root.hideLoading(root.listCreditsWindow);
    return root.showError(root.listCreditsWindow);
  };

  root.xhrLoadCredits.timedout = function() {
    return Ti.UI.createAlertDialog({
      title: 'ReallyLateBooking',
      message: L('errorHappened')
    }).show();
  };

  root.showCredits = function() {
    var signature, url;
    Ti.API.info('Entra en showCredits');
    root.noCreditsView.hide();
    root.showLoading(root.listCreditsWindow);
    url = root.urlSignature('/user/' + root.user.id + '/coupons');
    signature = root.doSignature(url);
    url = url + '/' + signature;
    root.xhrLoadCredits.open('GET', root.url + url);
    root.xhrLoadCredits.setRequestHeader("Accept-Language", Titanium.Locale.currentLanguage);
    return root.xhrLoadCredits.send();
  };

}).call(this);
