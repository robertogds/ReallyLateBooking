// Generated by CoffeeScript 1.3.3
(function() {

  root.xhrDeals = Titanium.Network.createHTTPClient({
    timeout: 25000
  });

  root.xhrDeals.onload = function() {
    var deals;
    Ti.API.info("****** en fetchdeals obtenemos: " + this.responseText);
    root.hideLoading(root.citiesWindow);
    root.hideLoading(root.allCitiesWindow);
    deals = JSON.parse(this.responseText);
    if (deals.status === void 0) {
      return root.showDeals(deals);
    } else {
      if (deals.status === 0) {
        Ti.API.info('**** Entra en waitingCity');
        return root.showNoDeals(deals.message);
      }
    }
  };

  root.xhrDeals.onerror = function() {
    root.hideLoading(root.citiesWindow);
    root.hideLoading(root.allCitiesWindow);
    Ti.UI.createAlertDialog({
      title: 'ReallyLateBooking',
      message: L('errorHappened')
    }).show();
    root.hideLoading(root.listDealsWindow);
    return root.showError(root.citiesWindow);
  };

  root.fetchDeals = function(city) {
    if (Titanium.Network.online === false) {
      Ti.UI.createAlertDialog({
        title: 'ReallyLateBooking',
        message: L('mustInternet')
      }).show();
      return root.showError(root.citiesWindow);
    } else {
      root.xhrDeals.open('GET', root.url + '/v2/deals/' + city.url);
      root.xhrDeals.setRequestHeader("Accept-Language", Titanium.Locale.currentLanguage);
      return root.xhrDeals.send();
    }
  };

  root.fetchDealsFake = function() {
    var deals;
    deals = [
      {
        'hotelName': 'Petit Palace Embassy',
        'salePriceCents': 140,
        'roomType': 'lujo',
        'priceCents': 250
      }, {
        'hotelName': 'Hotel Regina',
        'salePriceCents': 135,
        'roomType': 'elegante',
        'priceDay2': 110,
        'priceCents': 200
      }, {
        'hotelName': 'Vincci Soho',
        'salePriceCents': 120,
        'roomType': 'confort',
        'priceCents': 180
      }
    ];
    return root.populateDealsTable(deals);
  };

}).call(this);
