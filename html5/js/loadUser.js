(function(){root.loadUser=function(){Ti.API.info("Entra en loadUser");if(Titanium.App.Properties.hasProperty("user"))return Ti.API.info("Tiene user"),root.user=JSON.parse(Titanium.App.Properties.getString("user")),root.fetchCreditsAsync();if(Titanium.Facebook.loggedIn){Ti.API.info("Esta logado con facebook");if(Titanium.App.Properties.hasProperty("facebookUser"))return root.facebookUser=JSON.parse(Titanium.App.Properties.getString("facebookUser")),Ti.API.info("FACEBOOK EMAIL = "+root.facebookUser.email),
root.user=root.facebookUser,Ti.API.info("USEREMAIL = "+root.user.email),root.user.id=root.facebookUser.rlbId,root.user.token=root.facebookUser.rlbToken,root.user.secret=root.facebookUser.rlbSecret,root.user.password=root.facebookUser.rlbPassword,root.user.firstName=root.facebookUser.first_name,root.user.lastName=root.facebookUser.last_name,root.fetchCreditsAsync();Ti.API.info("Esta logado con facebook pero no tenemos datos, hacemos logout");Titanium.Facebook.logout();return root.creditsTab.badge=
"+5"}Ti.API.info("No tiene ni user ni esta logado con facebook, borramos todo");Titanium.App.Properties.removeProperty("user");Titanium.App.Properties.removeProperty("facebookUser");return root.creditsTab.badge="+5"};root.loadRefererId=function(){Ti.API.info("*** Entra en refererId");if(null===root.user.refererId||void 0===root.user.refererId||2>root.user.refererId.length)return Ti.API.info("*** El refererId es null"),root.fetchServerUser()};root.urlSignature=function(a){var b;b=(new Date).getTime();
return a+"/"+root.user.token+"/"+b};root.doSignature=function(a){return Titanium.Utils.md5HexDigest(a+root.user.secret)};root.isLogged=function(){Ti.API.info("Entra en isLogged");if(Titanium.App.Properties.hasProperty("user"))return Ti.API.info("isLogged TRUE"),!0;if(Titanium.App.Properties.hasProperty("facebookUser"))return Ti.API.info("isLogged TRUE - FACEBOOK"),!0;Ti.API.info("isLogged FALSE");return!1}}).call(this);