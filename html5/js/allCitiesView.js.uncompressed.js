// Generated by CoffeeScript 1.3.3
(function() {

  Ti.include('/js/CityHeaderView.js', '/js/OtherCityRow.js');

  root.allCitiesTable = Titanium.UI.createTableView({
    data: [],
    backgroundColor: 'transparent',
    separatorColor: '#1b3c50'
  });

  root.allCitiesWindow.add(root.allCitiesTable);

  root.allCitiesTable.addEventListener('click', function(e) {
    root.showLoading(root.allCitiesWindow, L('updatingHotels'));
    return root.loadDeals(e.row.city);
  });

  root.populateCitiesTable = function(cities) {
    var city, cityRow, data, first, header, lastName, section, _i, _len;
    Ti.API.info('Entra en all cities');
    data = [];
    lastName = "empty";
    first = true;
    section = Titanium.UI.createTableViewSection();
    for (_i = 0, _len = cities.length; _i < _len; _i++) {
      city = cities[_i];
      Ti.API.info('Entra en city ' + city.name + ' Country ' + city.country);
      if (city.isRoot) {
        cityRow = new root.OtherCityRow(city);
        if (city.country !== lastName) {
          if (first !== true) {
            data.push(section);
          }
          header = new root.CityHeaderView(city.country);
          first = false;
          section = Titanium.UI.createTableViewSection({
            headerView: header.view
          });
        }
        section.add(cityRow.row);
        lastName = city.country;
      }
    }
    data.push(section);
    if (data.length === 0) {
      root.allCitiesWindow.close();
    } else {
      root.allCitiesTable.setData(data);
      root.allCitiesTable.footerView = root.footerView;
    }
    root.hideLoading(root.allCitiesWindow);
    return Ti.API.info('*** fin populateDealsZoneTable');
  };

  root.showAllCities = function() {
    return root.fetchCities('ALLCITIES');
  };

}).call(this);
