(function(){root.xhrFacebookRegister=Titanium.Network.createHTTPClient();root.xhrFacebookRegister.onload=function(){var a;Ti.API.info("Entra en FacebookRegistre onLoad ok");Ti.API.info(this.responseText);a=JSON.parse(this.responseText);Ti.API.info(a);200===a.status?(Ti.API.info("Entra en status 200"),root.user=a.content,root.facebookUser.rlbId=root.user.id,root.facebookUser.rlbToken=root.user.token,root.facebookUser.rlbSecret=root.user.secret,root.facebookUser.rlbPassword=root.user.password,Ti.API.info(a.content),
root.hideLoading(root.newAccountWindow),root.hideLoading(root.signInWindow),root.newAccountWindow.close(),root.signInWindow.close(),"deals"===root.tabGroup.activeTab.id&&root.showConfirmBooking()):(Ti.API.error(a.content),Ti.UI.createAlertDialog({title:"ReallyLateBooking",message:L("errorHappened")}).show());Ti.API.info("*** Registra el usuario de facebook");return Titanium.App.Properties.setString("facebookUser",JSON.stringify(root.facebookUser))};root.xhrFacebookRegister.onerror=function(a){Ti.API.info("Ha entrado en facebook register ERROR");
root.showError(root.accountWindow);return Ti.API.error(a)};root.doFacebookRegister=function(a,c,d){var b;Ti.API.info("Entra en doFacebookRegister");b=Titanium.Utils.md5HexDigest("facebookUser");root.xhrFacebookRegister.open("POST",root.url+"/users");root.xhrFacebookRegister.setRequestHeader("Content-Type","application/json; charset=utf-8");root.xhrFacebookRegister.setRequestHeader("Accept-Language",Titanium.Locale.currentLanguage);a=JSON.stringify({email:a,password:b,firstName:c,lastName:d,isFacebook:"true"});
Ti.API.info(a);return root.xhrFacebookRegister.send(a)}}).call(this);